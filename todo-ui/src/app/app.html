<main class="container">
  <header class="header">
    <h1>Todo App</h1>

    @if (progress) {
      <div class="progress-card">
        <div class="progress-top">
          <div class="progress-title">Progress</div>
          <div class="progress-stats">
            {{ progress.done }} / {{ progress.total }} ({{ progress.percentage }}%)
          </div>
        </div>
        <div class="bar">
          <div class="fill" [style.width.%]="progress.percentage"></div>
        </div>
      </div>
    }
  </header>

  <form #f="ngForm" (ngSubmit)="addTodo()" class="todo-form">
    <input
      name="title"
      required
      placeholder="Title"
      [(ngModel)]="newTodo.title"
    />

    <input
      name="description"
      placeholder="Description"
      [(ngModel)]="newTodo.description"
    />

    <select name="priority" [(ngModel)]="newTodo.priority">
      @for (p of priorities; track p) {
        <option [value]="p">{{ p }}</option>
      }
    </select>

    <input type="date" name="dueDate" [(ngModel)]="newTodo.dueDate" />

    <button type="submit" [disabled]="f.invalid">Add Task</button>
  </form>

  @if (todos.length === 0) {
    <p class="empty">No tasks yet</p>
  }

  <section class="list">
    @for (t of todos; track t.id) {
      <div class="todo-item">
        <div class="todo-text">
          <div class="title-row">
            <strong>{{ t.title }}</strong>
            <span class="pill">{{ t.priority }}</span>
          </div>

          @if (t.description) {
            <small class="desc">{{ t.description }}</small>
          }

          <div class="meta">
            @if (t.dueDate) {
              <span class="due">Due: {{ t.dueDate | date:'mediumDate' }}</span>
            } @else {
              <span class="due muted">No due date</span>
            }
          </div>
        </div>

        <div class="todo-actions">
          <select
            [(ngModel)]="t.status"
            name="status-{{t.id}}"
            (change)="updateTodo(t)"
          >
            @for (s of statuses; track s) {
              <option [value]="s">{{ s }}</option>
            }
          </select>

          <button type="button" class="delete" (click)="deleteTodo(t.id)">âœ•</button>
        </div>
      </div>
    }
  </section>
</main>
